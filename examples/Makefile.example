CC=cc
CFLAGS=`pkg-config --cflags parsec` -Wall
LDFLAGS=`pkg-config --libs parsec`

PTGPP=parsec_ptgpp
PTGPPFLAGS=

EXAMPLES= Ex01_HelloWorld	\
	  Ex02_Chain		\
	  Ex03_ChainMPI		\
	  Ex04_ChainData	\
	  Ex05_Broadcast	\
	  Ex06_RAW		\
	  Ex07_RAW_CTL		\

# Keep intermediate .c/.h files generated by parsec_ptgpp
EXAMPLES_C=${EXAMPLES:=.c}
EXAMPLES_H=${EXAMPLES:=.h}

.SECONDARY: ${EXAMPLES_H} ${EXAMPLES_C}

default: Ex00_StartStop ${EXAMPLES}


Ex00_StartStop: Ex00_StartStop.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

%.c: %.jdf
	${PTGPP} -i $< -o `basename $@ .c` ${PTGPPFLAGS} -- ${CFLAGS}

%.o: %.c
	${CC} -o $@ -c $< ${CFLAGS}

Ex01_HelloWorld: Ex01_HelloWorld.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex02_Chain: Ex02_Chain.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex03_ChainMPI: Ex03_ChainMPI.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex04_ChainData: Ex04_ChainData.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex05_Broadcast: Ex05_Broadcast.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex06_RAW: Ex06_RAW.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

Ex07_RAW_CTL: Ex07_RAW_CTL.o
	${CC} -o $@ $< ${CFLAGS} ${LDFLAGS}

clean:
	rm -f *.o

cleanall: clean
	rm -f Ex00_StartStop ${EXAMPLES} ${EXAMPLES_C} ${EXAMPLES_H}
